---
title: "基于oauth2的接口鉴权设计"
date: 2018-12-12T11:24:44+08:00
draft: true
categories: ["Developer"] # Developer AI之遥 科幻Fans 智慧之光 星云尘埃 酷cool玩
slug: "open-api-management-based-oauth2"
tags: ["oauth2","spring-security"]
author: "Payne Xu"

---
# 开放平台漫谈

当一个系统的外部接入方变得越来越多，业务越来越复杂，帮助接入方排查问题耗费的时间越来越多，就有必要构建一套自助接入的系统。再进一步，就会演变成公司战略意义上开放平台。其实通俗的说，常规企业的开放平台就是提供一些接口，使得合作伙伴或个人能通过这些接口获得企业的服务、能力、数据。

## 意义

- 减轻外部接入时的人员消耗
- 规范快捷的接入方式
- 减轻开发不必要的工作量
- 有利于企业构建相应的生态体系
- 方便对接口进行管控

## 基本结构

开放平台的目的就是把企业的能力提供出去，不管是数据还是服务，都是需要通过接口来进行交互，归根结底是围绕API来进行平台搭建。对于API我们需要进行定义、接入、鉴权、管理等相关的操作，可以大体上分为如下功能模块：


![开放平台结构](https://storage.blog.fliaping.com/20181212/2018-12-12-20-57-54.png)

### 接口网关

1. 平台服务接口：提供标准的接口定义
2. 接口管理：管理接口上线下线，版本管理，限流降级等
3. 外部消息通知：耗时比较久的接口或者其它外部关心的事件，需要进行异步通知

### 鉴权服务

1. 应用鉴权：第三方应用是否有权限调用平台
2. 接口调用鉴权：第三方应用是否有权限以用户身份调用接口
3. 用户鉴权：开发者或者商户登录管理系统时的身份认证
4. 用户授权管理：用户授权给第三方应用，使其可以以用户身份调用接口

### 平台门户

1. 用户入驻：企业/商户注册入驻，资质审核
2. 开发者入驻：开发者注册，身份认证
3. 管理运维：用户可以管理修改个人资源，开发者可以配置应用
4. 帮助中心：开发者需要的开发文档以及用户的帮助文档

### 运营系统

1. 用户管理：运营人员对用户进行管理，例如拉黑、注销、审核等
2. 开发者管理：运营人员对开发者及其应用进行管理
3. 权限管理：运营人员对用户或者开发者的服务使用请求进行审核
4. 统计分析：对接口调用情况、第三方应用健康度等信息进行统计分析

# 鉴权

下面将对鉴权进行展开讨论。在开放平台的鉴权服务中主要涉及三个实体：开发者、用户和开放平台(企业)，他们之间的关系如下图所示：

![2018-12-13-14-03-38](https://storage.blog.fliaping.com/20181213/2018-12-13-14-03-38.png)

- 企业的能力通过开放平台接口的形式对外提供
  - 例如淘宝提供的是类似于市集的能力，商家可以把东西放到市集上，顾客到市集上买东西，提供的是卖家与卖家建立联系的服务。
  - 例如物流公司提供的是货物运转的能力，寄件人寄出物品，收件人签收物品，提供的是物品流通的服务
  - 当商家或寄件人是普通的个体，企业可以直接提供直接面向人的UI服务，但当出现面向其他企业的服务时，一套统一的系统往往不能满足所有企业的需要，并且随着业务复杂度的增加或者需求的快速变更，这套统一的系统也会不堪重负。这时需要将属于本企业的部分研发工作转嫁出去，通过开放平台的接口，将服务模块化，第三方企业可以根据自己的需要对模块进行组合，实现自己的需求。
- 开发者对开放平台的接口进行封装组成功能，提供给用户使用
  - 第三方企业的开发者进行研发工作，将开放平台的接口封装成本公司需要的功能。
  - 但是不是所有的第三方企业都有研发能力，可以将研发工作交给其他软件公司来做。
- 用户寄存资源在开放平台
  - 用户（第三方企业），如果使用了本公司的某些服务，就会产生数据、充值等，这些都是用户的资源。



![基于OAuth2的接口鉴权](https://storage.blog.fliaping.com/20181212/2018-12-12-21-02-12.png)

# 参考文章
