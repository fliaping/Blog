<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>http2总结及简单实践 - Fliaping&#39;s Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Payne Xu" />
  <meta name="description" content="HTTP发展历史 在总结http2之前先来回顾下http的发展历史。以下三张图片来自Jerry Qu HTTP/0.9 (1991) HTTP/1.0 (1996) HTTP/1.1 (1999) HTTP通信过程 众所周知，http" />

  <meta name="keywords" content="fliaping, Payne.Xu" />






<meta name="generator" content="Hugo 0.46" />


<link rel="canonical" href="https://blog.fliaping.com/http2-summary-and-simple-practicing/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">




<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<link href="/dist/even.min.css?v=3.2.0" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">




<meta property="og:title" content="http2总结及简单实践" />
<meta property="og:description" content="HTTP发展历史 在总结http2之前先来回顾下http的发展历史。以下三张图片来自Jerry Qu HTTP/0.9 (1991) HTTP/1.0 (1996) HTTP/1.1 (1999) HTTP通信过程 众所周知，http" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.fliaping.com/http2-summary-and-simple-practicing/" />



<meta property="article:published_time" content="2017-08-13T02:32:00&#43;00:00"/>

<meta property="article:modified_time" content="2017-08-13T02:32:00&#43;00:00"/>











<meta itemprop="name" content="http2总结及简单实践">
<meta itemprop="description" content="HTTP发展历史 在总结http2之前先来回顾下http的发展历史。以下三张图片来自Jerry Qu HTTP/0.9 (1991) HTTP/1.0 (1996) HTTP/1.1 (1999) HTTP通信过程 众所周知，http">


<meta itemprop="datePublished" content="2017-08-13T02:32:00&#43;00:00" />
<meta itemprop="dateModified" content="2017-08-13T02:32:00&#43;00:00" />
<meta itemprop="wordCount" content="4685">



<meta itemprop="keywords" content="http2," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="http2总结及简单实践"/>
<meta name="twitter:description" content="HTTP发展历史 在总结http2之前先来回顾下http的发展历史。以下三张图片来自Jerry Qu HTTP/0.9 (1991) HTTP/1.0 (1996) HTTP/1.1 (1999) HTTP通信过程 众所周知，http"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Fliaping&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Fliaping&#39;s Blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">http2总结及简单实践</h1>

      <div class="post-meta">
        <span class="post-time"> 2017-08-13 </span>
        <div class="post-category">
            
              <a href="/categories/http2/"> http2 </a>
            
          </div>
        <span class="more-meta"> 约 4685 字 </span>
        <span class="more-meta"> 预计阅读 10 分钟 </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次阅读 </span>
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li><a href="#http发展历史">HTTP发展历史</a>
<ul>
<li><a href="#http-0-9-1991">HTTP/0.9 (1991)</a></li>
<li><a href="#http-1-0-1996">HTTP/1.0 (1996)</a></li>
<li><a href="#http-1-1-1999">HTTP/1.1 (1999)</a></li>
</ul></li>
<li><a href="#http通信过程">HTTP通信过程</a></li>
<li><a href="#http-2-新特性">HTTP/2 新特性</a>
<ul>
<li><a href="#二进制分帧-binary-framing-layer">二进制分帧（Binary framing layer）</a></li>
<li><a href="#多路复用-multiplexing-单一连接-one-connection-per-origin">多路复用 (Multiplexing) &amp; 单一连接（One connection per origin）</a></li>
<li><a href="#数据流优先级-stream-prioritization">数据流优先级（Stream prioritization）</a></li>
<li><a href="#首部压缩-header-compression">首部压缩 (Header Compression)</a>
<ul>
<li><a href="#静态字典">静态字典</a></li>
<li><a href="#动态字典">动态字典</a></li>
<li><a href="#huffman-coding">Huffman Coding</a></li>
</ul></li>
<li><a href="#流控-flow-control">流控 (Flow control)</a></li>
<li><a href="#服务端推送-server-push">服务端推送 (Server Push)</a></li>
</ul></li>
<li><a href="#http-2简单实践">HTTP/2简单实践</a></li>
<li><a href="#参考内容">参考内容</a></li>
</ul>
</nav>
  </div>
</div>

    
    

    
    <div class="post-content">
      

<h1 id="http发展历史">HTTP发展历史</h1>

<p>在总结http2之前先来回顾下http的发展历史。以下三张图片来自<a href="https://imququ.com/post/http2-new-opportunities-and-challenges.html">Jerry Qu</a></p>

<h2 id="http-0-9-1991">HTTP/0.9 (1991)</h2>

<p><img src="https://o79q42bb0.qnssl.com/blog/http-0.9-connection-demo.png" alt="http-0.9-connection-demo" /></p>

<h2 id="http-1-0-1996">HTTP/1.0 (1996)</h2>

<p><img src="https://o79q42bb0.qnssl.com/blog/http-1.0-connection-demo.png" alt="http-1.0-connection-demo" /></p>

<h2 id="http-1-1-1999">HTTP/1.1 (1999)</h2>

<p><img src="https://o79q42bb0.qnssl.com/blog/http-1.1-connection-demo.png" alt="http-1.1-connection-demo" /></p>

<h1 id="http通信过程">HTTP通信过程</h1>

<p>众所周知，http是基于tcp之上的应用层协议，即在tcp连接建立之后，在tcp的链路上传送数据。</p>

<p><img src="https://o79q42bb0.qnssl.com/blog/http-data-transport-sequence-chart.png" alt="http-data-transport-sequence-chart" /></p>

<ol>
<li>首先进行TCP连接，三次握手，<code>C --(SYN{k})--&gt; S</code>，<code>S --(ACK{k+1}&amp;SYN{j})--&gt; C</code>， <code>C --ACK{j+1}--&gt; S</code></li>
<li>客户端发送ACK后，就会发送一个HTTP请求</li>
<li>服务端接受到ACK，确认TCP连接建立，再接着收到HTTP请求，进行解析并将结果返回客户端。</li>
<li>客户端收到HTTP请求结果。</li>
</ol>

<p>在<code>HTTP/0.9</code>和<code>HTTP/1.0</code>中，第3步之后，服务端就会关闭连接，也就是TCP的四次挥手，但是在<code>HTTP/1.1</code>后，客户端在发送HTTP请求时头部可以带上<code>Connection：Keep-Alive</code>，就是告诉服务器保持连接，不要关闭TCP。当<code>Connection:Close</code>时，服务器会关闭连接。</p>

<p><code>HTTP2</code>的通信过程无外乎这是这个流程，但是通过TCP传输的数据会有不同，客户端和服务器的行为也有了新的规则。引入了Connection、Stream、Message、Frame这四个概念，从下图大概可以看出他们之间的关系。</p>

<p><img src="https://o364p1r5a.qnssl.com/blog/http2-connection-stream-message-frame.png" alt="http2-connection-stream-message-frame" /></p>

<ul>
<li>Connection： 其实就是一个TCP连接</li>
<li>Stream：已建立的连接上的双向字节流</li>
<li>Message：请求或者响应，由一个或多个帧组合而成</li>
<li>Frame： Message中的二进制帧，HTTP/2通信的最小单位，后面会详细解释</li>
</ul>

<h1 id="http-2-新特性">HTTP/2 新特性</h1>

<ul>
<li>二进制分帧（Binary framing layer）</li>
<li>多路复用 (Multiplexing)</li>
<li>单一连接（One connection per origin）</li>
<li>数据流优先级（Stream prioritization）</li>
<li>首部压缩（Header Compression）</li>
<li>流控 (Flow control)</li>
<li>服务端推送（Server Push）</li>
</ul>

<p>这些新特性的产生，主要是为了解决之前的问题，我们来对比下之前的<code>HTTP/1.1</code>，看看解决了哪些问题</p>

<h2 id="二进制分帧-binary-framing-layer">二进制分帧（Binary framing layer）</h2>

<p>二进制分帧就是把http的数据按照规定的格式进行封装，类似IP和TCP的数据包, 简单画了个承载HTTP2数据的以太帧结构，方便理解。
<img src="https://o364p1r5a.qnssl.com/blog/the-ethernet-frame-of-overing-http2.png" alt="the-ethernet-frame-of-overing-http2" /></p>

<p><em>通过wireshark抓包可以看到http2的结构</em></p>

<p><img src="https://o364p1r5a.qnssl.com/blog/wireshark-http2-frame.png" alt="wireshark-http2-frame" /></p>

<ul>
<li>Length: 无符号的自然数，24个比特表示，仅表示帧负载所占用字节数，不包括帧头所占用的9个字节。默认大小区间为为0~16,384(2^14)，一旦超过默认最大值2^14(16384)，发送方将不再允许发送，除非接收到接收方定义的SETTINGS_MAX_FRAME_SIZE（一般此值区间为2^14 ~ 2^24）值的通知。</li>
<li>Type: 8个比特表示，定义了帧负载的具体格式和帧的语义，HTTP/2规范定义了10个帧类型，这里不包括实验类型帧和扩展类型帧</li>
<li>Flags: 8个比特表示，服务于具体帧类型，默认值为0x0。有一个小技巧需要注意，一般来讲，8个比特可以容纳8个不同的标志，比如，PADDED值为0x8，二进制表示为00001000；END_HEADERS值为0x4，二进制表示为00000100；END_STREAM值为0X1，二进制为00000001。可以同时在一个字节中传达三种标志位，二进制表示为00001101，即0x13。因此，后面的帧结构中，标志位一般会使用8个比特表示，若某位不确定，使用问号?替代，表示此处可能会被设置标志位</li>
<li>R: 在HTTP/2语境下为保留的比特位，固定值为0X0</li>
<li>Stream Identifier: 无符号的31比特表示无符号自然数。0x0值表示为帧仅作用于连接，不隶属于单独的流。</li>
</ul>

<p>HTTP2帧中的类型如下：<a href="https://www.iana.org/assignments/http2-parameters/http2-parameters.xhtml">参考链接</a></p>

<table>
<thead>
<tr>
<th align="center">Code</th>
<th>Frame Type</th>
<th>Comment</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">0x00</td>
<td>DATA</td>
<td>数据帧，主要用来传递消息体</td>
</tr>

<tr>
<td align="center">0x01</td>
<td>HEADERS</td>
<td>头部帧，主要用于传递消息头</td>
</tr>

<tr>
<td align="center">0x02</td>
<td>PRIORITY</td>
<td>优先级帧，用于设置流的优先级</td>
</tr>

<tr>
<td align="center">0x03</td>
<td>RST_STREAM</td>
<td>流结束帧，用于终止异常流</td>
</tr>

<tr>
<td align="center">0x04</td>
<td>SETTINGS</td>
<td>连接配置参数帧，用于设置参数</td>
</tr>

<tr>
<td align="center">0x05</td>
<td>PUSH_PROMISE</td>
<td>推送承诺帧，Server推送之前告知Client端</td>
</tr>

<tr>
<td align="center">0x06</td>
<td>PING</td>
<td>发送端测量最小的RTT时间，检测连接是否可用</td>
</tr>

<tr>
<td align="center">0x07</td>
<td>GOAWAY</td>
<td>超时帧，通知对端不要在连接上建新流</td>
</tr>

<tr>
<td align="center">0x08</td>
<td>WINDOW_UPDATE</td>
<td>实现流量控制</td>
</tr>

<tr>
<td align="center">0x09</td>
<td>CONTINUATION</td>
<td>延续帧，延续一个报头区块</td>
</tr>

<tr>
<td align="center">0x0a</td>
<td>ALTSVC</td>
<td>通知客户端可用的替代服务</td>
</tr>

<tr>
<td align="center">0xb-0xef</td>
<td>Unassigned</td>
<td>未分配</td>
</tr>

<tr>
<td align="center">0xf0-0xff</td>
<td>Reserved for Experimental Use</td>
<td>为实验性用途保留</td>
</tr>
</tbody>
</table>

<p><em>想了解每一个类型的详细数据结构可以参考我的另一篇文章 <a href="explanation-of-http2-frame-type">http2帧类型详解</a></em></p>

<p>通过Google Developers中的一个图，我们可以更好的理解，HTTP2的分帧在网络数据中所处的位置，以及和HTTP/1.1的不同之处。</p>

<p><img src="https://o364p1r5a.qnssl.com/blog/binary_framing_layer01.svg" alt="binary_framing_layer" /></p>

<p>HTTP/1.1中的头部变成HEADERS类型的帧，请求体/回应体变成DATA类型的帧，通过二进制分帧，将传输的数据使用二进制方式，对比文本方式减少数据量；通过不同类型的帧实现流控、服务器推送等功能。</p>

<h2 id="多路复用-multiplexing-单一连接-one-connection-per-origin">多路复用 (Multiplexing) &amp; 单一连接（One connection per origin）</h2>

<p>我们知道在HTTP2之前，我们如果想加快网页资源的加载速度，会采用同时建立多条连接的方式，但是这样每次建立TCP连接效率比较低，并且浏览器往往会限制最大连接数（例如chrome的最大连接数为6）。另外在HTTP/1.1中引入了Pipeline，可以在一个TCP连接中连续发送多个请求，不用关心前面的响应是否到达，但是服务器必须要按照收到请求的顺序来进行响应，这样一旦前面的请求阻塞，后来的请求也将不能及时回应。</p>

<p>HTTP2中，因为新的二进制帧的使用，使得可以轻松复用单个TCP连接。客户端和服务器可以将 HTTP 消息分解为互不依赖的帧，然后交错发送，最后再在另一端把它们重新组装起来。</p>

<p>还是 Google Developers的图：
<img src="https://o364p1r5a.qnssl.com/blog/multiplexing01.svg" alt="multiplexing" />
可以看到我们可以并行交错的发送多个响应和请求，并且使用同一个TCP连接，没有先后顺序，每个帧中携带有如何组装的信息，客户端会等某项工作所需要的所有的资源都就绪之后再执行。</p>

<h2 id="数据流优先级-stream-prioritization">数据流优先级（Stream prioritization）</h2>

<p>由于可以进行单连接复用，服务器和客户端的帧都是交错发送，对于发送给服务器的帧，为了解决哪些该先处理，哪些该后处理，因此引入了数据流的优先级，服务器根据优先级来分配资源。例如优先级高的获得更多的CPU和带宽资源。那么优先级是如何标示的呢？还记得前面的帧类型中有一个Type为PRIORITY，这种类型的帧就是为了告诉服务器这个stream的优先级，此外HEADERS帧中也包含了优先级信息。</p>

<p>HTTP/2通过父依赖和权重来标示优先级，每一个stream会标示一个父stream id，没有标示的默认为虚拟的root stream，这样按照这种依赖关系构建一个依赖树，树上层的stream权重较高，同一层的stream会有一个weight来区分资源分配比。。</p>

<p><img src="https://o364p1r5a.qnssl.com/blog/stream_prioritization01.svg" alt="stream_prioritization" /></p>

<p>上图是依赖树的一些示例，从左到右，共四棵树。
* 第一个两个stream A 和 B，没有标明父stream，默认依赖虚拟的root节点，A、B处于同一层，优先级相同，根据权重分配资源，A分到<code>12/(12+4)=3/4</code>资源，B分到<code>1/4</code>资源。
* 第二个D和C有层级结构，C的父级是D，那么服务器拿完整资源优先处理D，然后再处理C。
* 第三个，服务器先处理D，再处理C，然后处理A和B，A分到<code>3/4</code>资源，B分到<code>1/4</code>资源。
* 第四个，先处理D，再讲资源对半分处理E和C，之后再按照权重处理A和B</p>

<p><em>需要注意的一点是，流优先级并不是强制约束，当优先级高的流阻塞时，并不能不让服务器处理优先级低的流</em></p>

<h2 id="首部压缩-header-compression">首部压缩 (Header Compression)</h2>

<p>由于当前网站内容越来越复杂，单个页面的请求数基本都是几十个甚至上百，每个请求都要带上客户端或者用户的标识，例如：UA，cookie等头部数据，请求数量多了以后，传输http头部消耗的流量也非常可观，并且头部数据中大部分都是相同的，这就是赤裸裸的浪费呀。于是产生了头部压缩技术来节省流量。
<img src="https://o364p1r5a.qnssl.com/2017/08/hpack-header-compression-google-io.png" alt="hpack-header-compression-google-io" />
* 维护一份相同的静态字典（Static Table），包含常见的头部名称，以及特别常见的头部名称与值的组合
* 维护一份相同的动态字典（Dynamic Table），可以动态地添加内容
* 支持基于静态哈夫曼码表的哈夫曼编码（Huffman Coding）</p>

<h3 id="静态字典">静态字典</h3>

<p>静态字典就是把常用的头部映射为字节较短的索引序号，如下图所示，截取了前面几个映射，全部定义可以看<a href="https://http2.github.io/http2-spec/compression.html#rfc.section.A">Static Table Definition</a>
<img src="https://o364p1r5a.qnssl.com/2017/08/part-of-http2-hpack-static-table.png" alt="part-of-http2-hpack-static-table" />
例如当头部有个字段是<code>:method: GET</code>，那么查表可知，可以用序号2标识，于是这个字段的数据就是<code>0000010</code>(2的二进制表示)</p>

<h3 id="动态字典">动态字典</h3>

<p>静态字典能表示的头部数据毕竟有限，压缩率也不会高。但是对于一个站点来讲，和某个用户交互时会发生非常多的请求，但是每次请求头部差别不大，会有很多重复数据，因为用户和浏览器的标识是不变的。那么我们可以针对一次HTTP2的连接生成一个可添加映射的动态字典，这样再后面的连接中就可以使用动态字典中的序号。动态字典的生成过程其实就是通知对方添加映射，客户端可以通知服务端添加，反之亦可。</p>

<p>具体的通知方式就是按照协议规定的格式传输数据，具体请看文末参考文章。</p>

<h3 id="huffman-coding">Huffman Coding</h3>

<p>哈弗曼编码的特性是出现频率越高，编码长度越短。HTTP2协议中根据大量的请求头部数据样本生成了一种canonical Huffman code，具体在<a href="https://http2.github.io/http2-spec/compression.html#huffman.code">Huffman Code</a>列出。</p>

<h2 id="流控-flow-control">流控 (Flow control)</h2>

<p>HTTP/2 流量控制的目标，在流量窗口初始值的约束下，给予接收端以全权，控制当下想要接受的流量大小。</p>

<p><strong>算法：</strong>
1. 两端（收发）保有一个流量控制窗口（window）初始值。
2. 发送端每发送一个DATA帧，就把window递减，递减量为这个帧的大小，要是window小于帧大小，那么这个帧就必须被拆分。如果window等于0，就不能发送任何帧
3. 接收端可以发送 WINDOW_UPDATE帧给发送端，发送端以帧内指定的Window Size Increment作为增量，加到window上</p>

<h2 id="服务端推送-server-push">服务端推送 (Server Push)</h2>

<p><strong>流程:</strong>
1. 客户端在交换 SETTINGS 帧时，设置字段<code>SETTINGS_ENABLE_PUSH(0x2)</code>为1显式允许服务器推送
2. 服务器在接受到请求时，分析出要推送的资源，先发个 <code>PUSH_PROMISE</code> 帧给浏览器
3. 然后再发送各个response header和response body
4. 浏览器收到 <code>PUSH_PROMISE</code> 帧时，根据header block fragment字段里的url，可以知道当前有没有缓存，从而判断是否要接收。如果不要，浏览器就要发送个 <code>RST_STREAM</code> 来终止服务器推送</p>

<p><strong>问题：</strong>
流量浪费。若浏览器有缓存，不要这个推送，就会出现浪费流量的现象，因为整个过程都是异步的，在服务器接收到RST_STREAM时，响应很有可能部份发出或者全部发出了。</p>

<h1 id="http-2简单实践">HTTP/2简单实践</h1>

<p>Okhttp是一个java生态中有名的的http client，由于其简单易用，性能较好，支持http2。下面用这个工具来实践下，因为本人博客已经在nginx上配置了http2，就拿本博客来实验下。</p>

<pre><code class="language-java">public class Http2Example {
    final static OkHttpClient client = new OkHttpClient.Builder().build();
    public static void main(String[] args) {
        Request request = new Request.Builder()
                .url(&quot;https://blog.fliaping.com&quot;)
                .build();
        try {
            Response response = client.newCall(request).execute();
            System.out.println(JSON.toJSONString(response.protocol()));
            System.out.println(response.headers().toString());
            System.out.println(response.body().string());
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
</code></pre>

<p>用过Okhttp的同学就会发现，这跟平时用的方法一样啊，没有任何区别，是的没错，就是没有任何区别。别的不多说，执行下看看，不幸的是你会发现protocol还是http1.1，并不是h2，这是怎么回事？这是因为HTTP2新加入了ALPN（Application Layer Protocol Negotiation）,从字面意思理解就是应用层协议协商，即双方商量下用哪个协议。不幸的是jdk8是在2014年发布的，当时HTTP2协议还没出生，幸运的是通过第三方jar包就可以支持ALPN。另外jdk9已经支持了HTTP2，虽然还没正式发布，但是我们可以试用下JDK 9 Early-Access Builds。</p>

<p>jdk7和jdk8通过添加jvm参数加入第三方alpn支持包，注意版本不能搞错，jdk7使用<code>alpn-boot-7.*.jar</code> ，jdk8使用<code>alpn-boot-8.*.jar</code>，这里有版本对应关系 <a href="http://www.eclipse.org/jetty/documentation/current/alpn-chapter.html#alpn-versions">alpn-versions</a></p>

<pre><code class="language-bash"># jdk8
-Xbootclasspath/p:/home/payne/Downloads/alpn-boot-8.1.11.v20170118.jar
# jdk7
-Xbootclasspath/p:/home/payne/Downloads/alpn-boot-7.1.3.v20150130.jar
# jdk9
# 使用jdk9平台时，注意okhttp版本大于3.3.0

# https://mvnrepository.com/artifact/org.mortbay.jetty.alpn/alpn-boot
</code></pre>

<h1 id="参考内容">参考内容</h1>

<ul>
<li><a href="https://developers.google.com/web/fundamentals/performance/http2/">Introduction to HTTP/2</a></li>
<li><a href="https://imququ.com/post/header-compression-in-http2.html">HTTP/2 头部压缩技术介绍</a></li>
<li><a href="https://imququ.com/post/series.html">Jerry Qu-专题-HTTP/2相关</a></li>
</ul>

<p><a href="https://blog.fliaping.com/http2-summary-and-simple-practicing">原文链接</a></p>

    </div>

    
    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Payne Xu</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">2017-08-13</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>

    
    

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/http2/">http2</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/connecting-android-devices-with-linux/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Connecting Android Devices with Linux</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/re-move-back-to-alibaba-cloud-for-my-vps/">
            <span class="next-text nav-default">重新迁回阿里云</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'fliaping';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:xavierrpayne@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://twitter.com/xupingxx" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://www.linkedin.com/in/paynexu/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://github.com/fliaping" class="iconfont icon-github" title="github"></a>
  <a href="https://blog.fliaping.com/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> 本站总访问量 <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次 </span>
    <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> 本站总访客数 <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 人 </span>
  </div>

  <span class="copyright-year">
    &copy; 
    
      2015 - 
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">fliaping</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>


<script type="text/javascript" src="/dist/even.min.js?v=3.2.0"></script>


<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-63276498-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
